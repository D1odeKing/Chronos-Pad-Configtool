# Keycode Selector Redesign Plan (Phase 3.2)

**Generated By**: GitHub Copilot AI  
**Validated By**: D10D3K1NG  
**Status**: Planning  
**Date**: November 5, 2025

---

## ðŸŽ¯ Problem Analysis

### Current UI Issues (First Image)

1. **Redundant Navigation**
   - Horizontal category pills + vertical tabs both show categories
   - Users confused about which to use
   - Takes up too much vertical space
   - Pills and tabs don't sync properly

2. **Poor Category Discovery**
   - Categories only visible in tabs or pills
   - Hard to see all categories at once
   - Tedious scrolling through horizontal pills
   - No visual distinction between categories

3. **Inefficient List View**
   - QListWidget shows keycodes in single column
   - No grouping by subcategory
   - Hard to scan large lists (20+ items)
   - Poor visual hierarchy

4. **Search Integration**
   - Global search bar exists but tabs take precedence
   - Users must still browse tabs even with search
   - Search doesn't clearly show results by category

5. **Space Usage**
   - Horizontal pills waste precious horizontal space
   - Tabs add another layer of navigation
   - Limited room for actual keycode display

### Target Design (Second Image)

âœ… **Clean Sidebar Layout**
- Left: Vertical list of categories with badges
- Right: Keycodes for selected category
- Clear, scannable organization

âœ… **Visual Organization**
- Categories as buttons with icons and counts
- Active category highlighted in blue
- Better use of screen space

âœ… **Efficient Navigation**
- One click to change category (sidebar)
- No redundant navigation elements
- Search filters current category or all categories

âœ… **Macros/TapDance Integration**
- Separate tabbed section below
- Independent from keycode selection
- Clear action buttons (Create, Edit, Delete)

---

## ðŸ“ UI Layout Structure

### New Layout (Target)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Key Assignment Panel                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ Selected Key: None / KC.A                         â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ Search all keycodes... [search box]              â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ CATEGORIES â”‚ KEYCODES                         â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ ðŸ”¤ Letters â”‚ KC.A                             â”‚  â”‚
â”‚ â”‚ (26)       â”‚ KC.B                             â”‚  â”‚
â”‚ â”‚            â”‚ KC.C                             â”‚  â”‚
â”‚ â”‚ ðŸ”¢ Numbers â”‚ KC.D                             â”‚  â”‚
â”‚ â”‚ (10)       â”‚ ...                              â”‚  â”‚
â”‚ â”‚            â”‚                                  â”‚  â”‚
â”‚ â”‚ âœ Editing  â”‚                                  â”‚  â”‚
â”‚ â”‚ (8)        â”‚                                  â”‚  â”‚
â”‚ â”‚            â”‚                                  â”‚  â”‚
â”‚ â”‚ âŒ¨ Modifiersâ”‚                                  â”‚  â”‚
â”‚ â”‚ (8)        â”‚                                  â”‚  â”‚
â”‚ â”‚            â”‚                                  â”‚  â”‚
â”‚ â”‚ ðŸ§­ Navig.  â”‚                                  â”‚  â”‚
â”‚ â”‚ (12)       â”‚                                  â”‚  â”‚
â”‚ â”‚            â”‚                                  â”‚  â”‚
â”‚ â”‚ ðŸ”§ Func    â”‚                                  â”‚  â”‚
â”‚ â”‚ (12)       â”‚                                  â”‚  â”‚
â”‚ â”‚            â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚ â”‚ ðŸ”Š Media   â”‚ â”‚[Combo][Clear][Transparent]â”‚  â”‚  â”‚
â”‚ â”‚ (6)        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ âš¡ Macros | ðŸŽ¯ TapDance                        â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚ Available Macros:                                â”‚â”‚
â”‚ â”‚ â€¢ ALTAB                                          â”‚â”‚
â”‚ â”‚ â€¢ CMD                                            â”‚â”‚
â”‚ â”‚ â€¢ COPY                                           â”‚â”‚
â”‚ â”‚ â€¢ PASS                                           â”‚â”‚
â”‚ â”‚                                                  â”‚â”‚
â”‚ â”‚ [+ Create] [âœŽ Edit] [ðŸ—‘ Delete]                â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ Implementation Steps

### Step 1: Replace Tab Widget with Sidebar Layout

**Current Code**:
```python
# Old approach: tab_widget with QListWidget per tab
tab_widget = QTabWidget()
for category_name, keycodes in KEYCODES.items():
    list_widget = QListWidget()
    # populate list_widget
    tab_widget.addTab(list_widget, category_name)
```

**New Approach**:
```python
# New approach: Sidebar + Content area
main_layout = QHBoxLayout()

# Left sidebar: Category buttons
sidebar_layout = QVBoxLayout()
category_buttons = {}
for category_name in KEYCODES.keys():
    btn = QPushButton(f"{CATEGORY_ICONS[category_name]} {category_name}")
    btn.clicked.connect(lambda checked, cat=category_name: self.select_category(cat))
    category_buttons[category_name] = btn
    sidebar_layout.addWidget(btn)
sidebar_layout.addStretch()
sidebar_widget = QWidget()
sidebar_widget.setLayout(sidebar_layout)

# Right content: Keycode list
content_layout = QVBoxLayout()
self.keycode_list = QListWidget()
content_layout.addWidget(self.keycode_list)
content_widget = QWidget()
content_widget.setLayout(content_layout)

# Combine
splitter = QSplitter(Qt.Horizontal)
splitter.addWidget(sidebar_widget)
splitter.addWidget(content_widget)
splitter.setSizes([150, 400])
```

### Step 2: Add Visual Category Indicators

**What to Add**:
- Category icons (ðŸ”¤ ðŸ”¢ âœ âŒ¨ ðŸ§­ ðŸ”§ ðŸ”Š ðŸ’¡ ðŸ–± ðŸ“š â­)
- Badge showing keycode count per category
- Active category: Blue background + white text
- Hover effect: Lighter background

**Styling**:
```python
# Active category
btn.setStyleSheet("""
    QPushButton {
        background-color: #4a9aff;
        color: white;
        font-weight: bold;
        border-radius: 6px;
        padding: 8px 12px;
    }
    QPushButton:hover {
        background-color: #60a5fa;
    }
""")

# Inactive category
btn.setStyleSheet("""
    QPushButton {
        background-color: #374151;
        color: #e5e7eb;
        border-radius: 6px;
        padding: 8px 12px;
    }
    QPushButton:hover {
        background-color: #4b5563;
    }
""")
```

### Step 3: Implement Category Selection

**New Method**: `select_category(category_name: str)`

```python
def select_category(self, category_name: str) -> None:
    """
    Switch to selected category and populate keycode list.
    
    Updates sidebar button states and displays keycodes for selected category.
    """
    # Update button states
    for name, btn in self.category_buttons.items():
        if name == category_name:
            btn.setProperty("active", True)
            self._apply_active_button_style(btn)
        else:
            btn.setProperty("active", False)
            self._apply_inactive_button_style(btn)
    
    # Populate keycode list
    self.keycode_list.clear()
    for keycode in self.KEYCODES[category_name]:
        self.keycode_list.addItem(keycode)
    
    # Update selected category tracking
    self.current_category = category_name
    self.save_session_state()
```

### Step 4: Improve Search Functionality

**Current**: Search per-tab  
**Target**: Search across all categories, show results organized by category

**New Method**: `_search_all_keycodes(query: str)`

```python
def _search_all_keycodes(self, query: str) -> None:
    """
    Search across all categories and display results.
    
    Results are grouped by category. Empty search shows first category.
    """
    if not query:
        # Show first category by default
        self.select_category(list(self.KEYCODES.keys())[0])
        return
    
    # Search all categories
    self.keycode_list.clear()
    query_lower = query.lower()
    found_any = False
    
    for category_name, keycodes in self.KEYCODES.items():
        matching = [kc for kc in keycodes if query_lower in kc.lower()]
        
        if matching:
            found_any = True
            # Add category header
            header_item = QListWidgetItem(f"-- {category_name} --")
            header_item.setForeground(QColor("#9ca3af"))
            header_item.setBackground(QColor("#1f2937"))
            header_item.setFlags(header_item.flags() & ~Qt.ItemIsSelectable)
            self.keycode_list.addItem(header_item)
            
            # Add matching keycodes
            for keycode in matching:
                self.keycode_list.addItem(keycode)
    
    if not found_any:
        self.keycode_list.addItem("No matching keycodes found")
```

### Step 5: Separate Macros and TapDance

**Current**: Both in tabs below keycodes  
**Target**: Clear tabbed interface like second image

**Structure**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš¡ Macros | ðŸŽ¯ TapDance â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Available Macros:       â”‚
â”‚ â€¢ ALTAB                 â”‚
â”‚ â€¢ CMD                   â”‚
â”‚ â€¢ COPY                  â”‚
â”‚                         â”‚
â”‚ [+ Create] [âœŽ Edit]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Implementation**:
- Tabs: âš¡ Macros | ðŸŽ¯ TapDance (similar to current)
- Styling: Match modern button design
- Content: QListWidget of available items
- Actions: Create, Edit, Delete buttons

### Step 6: Add Quick Action Buttons

**Buttons Below Keycode List**:
- `[Combo]` - Open combo builder
- `[Clear]` - Set to KC.NO
- `[Transparent]` - Set to KC.TRNS
- `[Apply]` - Apply selected keycode to grid key

**Layout**:
```python
actions_layout = QHBoxLayout()
combo_btn = QPushButton("Combo")
combo_btn.clicked.connect(self.open_combo_builder)
actions_layout.addWidget(combo_btn)

clear_btn = QPushButton("Clear")
clear_btn.clicked.connect(lambda: self.apply_keycode("KC.NO"))
actions_layout.addWidget(clear_btn)

transparent_btn = QPushButton("Transparent")
transparent_btn.clicked.connect(lambda: self.apply_keycode("KC.TRNS"))
actions_layout.addWidget(transparent_btn)

actions_layout.addStretch()
```

### Step 7: Keyboard Navigation

**Shortcuts**:
- `â†‘/â†“`: Navigate through keycodes in list
- `â†’`: Switch to next category
- `â†`: Switch to previous category
- `Enter`: Apply selected keycode
- `Escape`: Close selector

**Implementation**:
```python
def keyPressEvent(self, event: QKeyEvent) -> None:
    """Handle keyboard navigation in keycode selector."""
    if event.key() == Qt.Key_Up:
        self._move_selection(-1)
    elif event.key() == Qt.Key_Down:
        self._move_selection(1)
    elif event.key() == Qt.Key_Left:
        self._select_previous_category()
    elif event.key() == Qt.Key_Right:
        self._select_next_category()
    elif event.key() == Qt.Key_Return:
        self._apply_selected_keycode()
    elif event.key() == Qt.Key_Escape:
        self.close()
    else:
        super().keyPressEvent(event)
```

---

## ðŸŽ¨ Visual Design Improvements

### Category Sidebar

- **Width**: 140-160px (fixed, user-resizable in future)
- **Icons**: 2px left padding, 12px font size
- **Badge**: Top-right corner showing count
- **Height**: 40px per category button
- **Spacing**: 8px between buttons
- **Active**: Blue (#4a9aff) background
- **Inactive**: Gray (#374151) background

### Keycode List

- **Background**: #1f2937
- **Text**: #e5e7eb
- **Selection**: #4a9aff background
- **Hover**: #4b5563 background
- **Row Height**: 28px
- **Padding**: 8px per item
- **Font**: Monospace 11pt

### Search Bar

- **Position**: Top of right panel
- **Background**: #374151
- **Text**: #e5e7eb
- **Placeholder**: #9ca3af
- **Border**: 1px #4b5563
- **Rounded**: 6px
- **Height**: 36px

---

## ðŸ“Š Expected Benefits

| Issue | Current | Redesigned |
|-------|---------|-----------|
| Category navigation | Pills + Tabs (redundant) | Sidebar (single source) |
| Category discovery | Hard to see all | Vertical list visible |
| Browse keycodes | Single column list | Better organized |
| Search experience | Search works but tabs shown | Global search focused |
| Screen real estate | Horizontal pills wasteful | Efficient layout |
| Visual hierarchy | Unclear categories | Clear categorization |
| Keyboard UX | Arrow keys don't work | Full keyboard support |
| Space for content | Limited | Optimized |

---

## ðŸ”§ Technical Considerations

### State Management

**Session Persistence** (save/restore):
- `current_category`: Last selected category
- `keycode_sidebar_width`: Sidebar width if resizable
- `search_query`: Last search (optional)

**Update `save_session_state()`**:
```python
session_data['keycode_current_category'] = self.current_category
session_data['keycode_search_query'] = self.search_box.text()
```

**Update `restore_session_state()`**:
```python
category = session_data.get('keycode_current_category', 'Letters')
self.select_category(category)
self.search_box.setText(session_data.get('keycode_search_query', ''))
```

### Performance

- **Category size**: Largest is ~30 keycodes (OK for QListWidget)
- **Search**: O(n) across all categories (fast for ~200 keycodes)
- **Rendering**: Sidebar buttons lightweight, list widget efficient
- **Memory**: ~same as current (tabs aren't freed in current approach anyway)

### Compatibility

- Keep `KEYCODES` dictionary structure unchanged
- Keep category icons mapping
- Keep macro/tapdance functionality intact
- Keep keycode assignment logic identical

---

## ðŸ“‹ Implementation Checklist

- [ ] **Step 1**: Remove tab widget, create sidebar + content layout
- [ ] **Step 2**: Style category buttons with icons and badges
- [ ] **Step 3**: Implement `select_category()` method
- [ ] **Step 4**: Implement global search with category grouping
- [ ] **Step 5**: Separate Macros/TapDance into clean tabs
- [ ] **Step 6**: Add quick action buttons (Combo, Clear, Transparent)
- [ ] **Step 7**: Implement keyboard navigation
- [ ] **Step 8**: Update session persistence
- [ ] **Step 9**: Test all categories and search
- [ ] **Step 10**: Validate keyboard shortcuts
- [ ] **Step 11**: Check responsive layout on different screen sizes
- [ ] **Step 12**: Commit and document changes

---

## ðŸŽ¬ Next Steps

1. **Code Review**: Review this plan with D10D3K1NG
2. **Approval**: Get feedback on design approach
3. **Implementation**: Start with Step 1 (layout refactor)
4. **Testing**: Test each step before proceeding to next
5. **Integration**: Ensure all existing features still work
6. **Documentation**: Update ARCHITECTURE.md with new design

---

**Plan Status**: Ready for Implementation  
**Estimated Effort**: 4-6 hours coding + 1-2 hours testing  
**Dependencies**: None (self-contained refactor)  
**Risk Level**: Medium (UI refactor, but keycodes selection logic unchanged)
